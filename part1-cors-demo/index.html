<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Part 1: CORS & Authentication Demo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000000;
            background-image: url('assets/skyline.jpeg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 0;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        .logo {
            display: block;
            max-width: 400px;
            margin: 0 auto 30px;
        }
        .content-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .right-panel {
            position: sticky;
            top: 20px;
            align-self: start;
        }
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 20px;
            font-size: 2.5em;
        }
        .demo-section {
            background: rgba(26, 26, 46, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            margin-bottom: 20px;
        }
        .demo-section h2 {
            color: #ffffff;
            margin-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 10px;
        }
        .demo-section p, .demo-section ul, .demo-section li {
            color: #d0d0d0;
        }
        .error {
            background-color: rgba(255, 68, 68, 0.1);
            border-left: 4px solid #ff4444;
            padding: 10px;
            margin: 10px 0;
            color: #ffb3b3;
        }
        .warning {
            background-color: rgba(255, 193, 7, 0.1);
            border-left: 4px solid #ffc107;
            padding: 10px;
            margin: 10px 0;
            color: #ffecb3;
        }
        button {
            background: rgba(255, 255, 255, 0.9);
            color: #000000;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }
        button:hover {
            background: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 255, 255, 0.4);
        }
        code {
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #00ff41;
            border: 1px solid rgba(0, 255, 65, 0.2);
        }
        .code-block {
            background: rgba(0, 0, 0, 0.7);
            color: #00ff41;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border: 1px solid rgba(0, 255, 65, 0.3);
        }
        #output {
            background: rgba(0, 0, 0, 0.9);
            color: #00ff41;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            min-height: 300px;
            max-height: 600px;
            overflow-y: auto;
            white-space: pre-wrap;
            border: 1px solid rgba(0, 255, 65, 0.3);
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            gap: 10px;
        }
        .nav-button {
            background: white;
            color: #667eea;
            border: 2px solid white;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        .nav-button:hover {
            background: rgba(255,255,255,0.9);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 255, 255, 0.3);
        }
        .subtitle {
            color: white;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1em;
            opacity: 0.95;
        }
        .info-banner {
            background: rgba(26, 26, 46, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            margin-bottom: 20px;
        }
        .info-banner h3 {
            color: #ffffff;
            margin-bottom: 15px;
        }
        .info-banner ul {
            margin: 10px 0 10px 20px;
        }
        .info-banner li {
            margin: 5px 0;
            color: #d0d0d0;
        }
        .info-banner p {
            color: #d0d0d0;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="https://privkey.io" target="_blank" rel="noopener noreferrer">
            <img src="assets/privkey-logo.png" alt="PrivKey LLC" class="logo">
        </a>
        <h1>üåê Part 1: Feel the Pain</h1>
        <p class="subtitle">CORS & Authentication Barriers</p>

        <div class="navigation">
            <a href="/part0-setup/" class="nav-button">‚Üê Back to Part 0</a>
            <a href="/part2-gateway-connection/" class="nav-button">Next: Part 2 ‚Üí</a>
        </div>

        <div class="info-banner">
            <h3>üéØ What You'll Learn</h3>
            <ul>
                <li>Why browsers block direct TAPD connections</li>
                <li>How CORS policies prevent API calls</li>
                <li>The complexity of macaroon authentication</li>
                <li>Why TLS certificates cause issues</li>
            </ul>
            <p style="margin-top: 15px;"><strong>The Error You'll See:</strong></p>
            <code style="display: block; background: rgba(0, 0, 0, 0.7); padding: 10px; border-radius: 4px; margin-top: 5px; color: #ff4444; border: 1px solid rgba(255, 68, 68, 0.3);">
                Access to fetch at 'https://127.0.0.1:8289/v1/taproot-assets/assets' from origin 'http://localhost:8000' has been blocked by CORS policy
            </code>
        </div>

        <div class="info-banner">
            <h3>üìö Context: The Three Barriers</h3>
            <p style="margin-bottom: 15px;">In Part 0, we set up the gateway to handle three fundamental web security issues:</p>

            <ul style="margin-left: 20px;">
                <li style="margin: 8px 0;"><strong>üõ°Ô∏è CORS:</strong> Browser security that blocks cross-origin requests</li>
                <li style="margin: 8px 0;"><strong>üç™ Macaroons:</strong> Binary authentication files that browsers can't access</li>
                <li style="margin: 8px 0;"><strong>üîí TLS Certificates:</strong> Self-signed certificates that browsers reject</li>
            </ul>

            <p style="margin-top: 15px; padding: 15px; background: rgba(102, 126, 234, 0.1); border-left: 4px solid #667eea; border-radius: 4px;">
                <strong>üí° The Gateway Solution:</strong> The REST gateway from Part 0 sits between your web app and TAPD. It runs as a server (not in the browser), so it can read macaroon files, handle TLS certificates, and add proper CORS headers. This is why we need it!
            </p>
        </div>

        <button onclick="clearConsole()" style="background-color: #dc3545; color: white; margin-bottom: 20px;">Clear Console</button>

        <div class="content-wrapper">
            <div class="left-panel">
                <div class="demo-section">
                    <h2>1. Direct API Call (Will Fail with CORS)</h2>
                    <p style="margin-bottom: 15px;">This demonstrates the immediate wall web developers hit when trying to call TAPD directly from a browser.</p>

                    <div style="margin: 15px 0; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 8px;">
                        <p style="margin-bottom: 10px;"><strong>What this call does:</strong> Attempts to fetch the list of Taproot Assets from TAPD's REST API endpoint <code>/v1/taproot-assets/assets</code>.</p>
                        <p style="margin-bottom: 10px;"><strong>What you'll see:</strong> A CORS error because the browser blocks cross-origin requests. Your web app (<code>http://localhost:8999</code>) and TAPD (<code>https://127.0.0.1:8289</code>) are different origins.</p>
                        <p><strong>Expected response (if CORS wasn't blocking):</strong> A JSON array of asset objects with fields like <code>asset_genesis</code>, <code>amount</code>, and <code>asset_type</code>.</p>
                    </div>

                    <button onclick="attemptDirectCall()">Try Direct API Call</button>
                    <div class="code-block">// What we're trying to do:
fetch('https://127.0.0.1:8289/v1/taproot-assets/assets')
  .then(response => response.json())
  .then(data => console.log(data))</div>
                </div>

                <div class="demo-section">
                    <h2>2. Macaroon Authentication Complexity</h2>
                    <p style="margin-bottom: 15px;">Even if CORS wasn't an issue, the macaroon authentication is complex.</p>

                    <div style="margin: 15px 0; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 8px;">
                        <p style="margin-bottom: 10px;"><strong>What this demonstrates:</strong> The multi-step process required to authenticate with TAPD using macaroons.</p>
                        <p style="margin-bottom: 10px;"><strong>Why it's complex:</strong> Macaroons are binary files stored on your file system that must be read, encoded to hex, and included as HTTP headers. Browsers can't access local files, and you shouldn't expose admin credentials in frontend code.</p>
                        <p><strong>The security problem:</strong> If you could do this in a browser, any malicious script on your page could steal your admin macaroon and take over your node!</p>
                    </div>

                    <button onclick="showMacaroonComplexity()">Show Macaroon Requirements</button>
                    <div class="warning">
                        <strong>Macaroon Location:</strong> /Users/yourusername/.polar/networks/1/volumes/lnd/regtest/admin.macaroon
                    </div>
                </div>

                <div class="demo-section">
                    <h2>3. TLS Certificate Issues</h2>
                    <p style="margin-bottom: 15px;">Self-signed certificates add another layer of complexity.</p>

                    <div style="margin: 15px 0; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 8px;">
                        <p style="margin-bottom: 10px;"><strong>What this demonstrates:</strong> Why browsers reject TAPD's self-signed TLS certificate by default.</p>
                        <p style="margin-bottom: 10px;"><strong>What's a self-signed certificate:</strong> Development environments like Polar generate their own HTTPS certificates instead of using a trusted Certificate Authority. This is normal for local development but browsers treat them as untrustworthy.</p>
                        <p><strong>The result:</strong> Even if you manually accept the certificate warning, CORS will still block the request. You'd need both certificate acceptance AND CORS headers to succeed.</p>
                    </div>

                    <button onclick="showTLSIssues()">Show TLS Problems</button>
                </div>

                <div class="demo-section">
                    <h2>üí° The Solution</h2>
                    <p>A REST gateway solves these issues by:</p>
                    <ul>
                        <li>‚úÖ Handling CORS headers properly</li>
                        <li>‚úÖ Managing macaroon authentication server-side</li>
                        <li>‚úÖ Dealing with TLS certificates</li>
                        <li>‚úÖ Providing a clean REST API for web developers</li>
                    </ul>
                </div>
            </div>

            <div class="right-panel">
                <div class="demo-section">
                    <h2>üìä Console Output</h2>
                    <div id="output">Ready to demonstrate TAPD integration challenges...

Click any button to see the issues web developers face.</div>
                </div>
            </div>
        </div>

        <div class="navigation" style="margin-top: 30px;">
            <a href="/part0-setup/" class="nav-button">‚Üê Back to Part 0</a>
            <a href="/part2-gateway-connection/" class="nav-button">Next: Part 2 ‚Üí</a>
        </div>
    </div>

    <script>
        function clearConsole() {
            const output = document.getElementById('output');
            output.textContent = 'Ready to demonstrate TAPD integration challenges...\n\nClick any button to see the issues web developers face.';
        }

        function log(message, isError = false) {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = isError ? '‚ùå ERROR' : 'üìù INFO';
            output.textContent += `[${timestamp}] ${prefix}: ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }

        async function attemptDirectCall() {
            const output = document.getElementById('output');
            output.textContent = '';
            log('Attempting direct call to TAPD REST API...');
            log('URL: https://127.0.0.1:8289/v1/taproot-assets/assets');
            
            try {
                const response = await fetch('https://127.0.0.1:8289/v1/taproot-assets/assets', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                log(`Response status: ${response.status}`);
                const data = await response.json();
                log(`Response data: ${JSON.stringify(data, null, 2)}`);
                
            } catch (error) {
                log(`CORS Error (as expected): ${error.message}`, true);
                log('This is the wall every web developer hits!', true);
                log('Browser security prevents direct calls to TAPD', true);
            }
        }

        function showMacaroonComplexity() {
            const output = document.getElementById('output');
            output.textContent = '';
            log('=== MACAROON AUTHENTICATION COMPLEXITY ===');
            log('1. Must read binary macaroon file from filesystem');
            log('2. Convert to hex or base64 encoding');
            log('3. Add to Grpc-Metadata-macaroon header');
            log('4. Handle macaroon caveat restrictions');
            log('');
            log('Example macaroon header (truncated):');
            log('Grpc-Metadata-macaroon: 0201036c6e6402f801030a10...');
            log('');
            log('This is impossible to do securely in a browser!', true);
            log('Macaroon files contain sensitive admin credentials', true);
        }

        function showTLSIssues() {
            const output = document.getElementById('output');
            output.textContent = '';
            log('=== TLS CERTIFICATE PROBLEMS ===');
            log('1. TAPD uses self-signed certificates');
            log('2. Browsers reject self-signed certs by default');
            log('3. Certificate path: /Users/yourusername/.polar/networks/1/volumes/lnd/alice-tap/tls.cert');
            log('4. Cannot easily import custom CA in web apps');
            log('');
            log('Even with --ignore-certificate-errors flag:', true);
            log('Still blocked by CORS policy', true);
        }
    </script>
</body>
</html>